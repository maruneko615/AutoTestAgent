# AutoTestBuilder 功能需求規格

## 工具概述
AutoTestBuilder 是定制化測試工具建置器，根據測試參數修改基礎版 AutoTestAgent，生成針對特定測試需求的定制化工具。

## 核心功能

### 雙模式執行
- **本地互動模式** - 開發階段使用，支援自然語言指令輸入
- **GitHub Action 模式** - 正式流程使用，接收自然語言指令自動建置

### 指令解析引擎
- **自然語言解析** - 將中文描述轉換為測試邏輯
- **意圖識別** - 識別流程狀態和操作類型
- **參數提取** - 從描述中提取具體的測試參數
- **指令驗證** - 確保解析結果的有效性

### 測試參數支援
- **統一自然語言格式** - 本地和 GitHub Action 都使用中文描述：
  - "每次都在選擇關卡選擇北京"
  - "在選擇武器流程依序選擇武器"
  - "在主選單隨機選擇選項"

### Q CLI 調用機制
- **環境檢測** - 區分 Windows 和 Linux/macOS 環境
- **程式碼生成** - 呼叫 Q CLI 根據指令和配置生成定制化程式碼
- **錯誤處理** - 完整的返回碼和輸出檢查

## 技術規格

### 執行環境
- **平台**: Windows 10/11
- **Python**: 3.8+
- **依賴**: 無額外依賴

### 指令格式
```bash
# 本地互動模式
python AutoTestBuilder.py --interactive

# GitHub Action 模式
python AutoTestBuilder.py --command="每次都在選擇關卡選擇北京"
```

### 自然語言指令範例
```
# 本地執行時的中文指令
"每次都在選擇關卡選擇北京"
"在選擇武器流程依序選擇武器"  
"在主選單隨機選擇選項"
"選擇賽道時固定選擇上海"
```

### 程式架構
```
AutoTestBuilder
├── 指令解析器
│   ├── 參數驗證
│   └── 格式解析
├── 程式碼修改引擎
│   ├── 基礎版本載入
│   ├── 邏輯注入
│   └── 定制版本生成
├── 互動介面
│   ├── 指令輸入
│   ├── 即時執行
│   └── 結果顯示
└── 日誌系統
    ├── 操作記錄
    └── 錯誤追蹤
```

## 執行流程

### 本地互動模式
1. **啟動互動介面** - 顯示指令提示
2. **接收用戶指令** - 解析測試參數
3. **修改程式碼** - 注入定制化邏輯
4. **生成定制版本** - 儲存 AutoTestAgent_Custom.py
5. **詢問執行** - 可選擇立即執行測試
6. **循環等待** - 繼續接收下一個指令

### GitHub Action 模式
1. **接收參數** - 從命令列獲取測試參數
2. **驗證參數** - 檢查參數格式和有效性
3. **修改程式碼** - 自動注入定制化邏輯
4. **生成輸出** - 產生最終測試工具
5. **回傳結果** - 提供建置狀態

## 定制化邏輯

### 流程狀態匹配
```python
# 動態讀取 GameSetting.md 確定流程狀態欄位名稱
if hasattr(game_data, '{dynamic_flow_field}') and str(getattr(game_data, '{dynamic_flow_field}')) == '{flow_state}':
    # 使用指定按鍵
else:
    # 使用隨機按鍵
```

### 輸入按鍵控制
- **特定按鍵** - 在指定流程使用固定按鍵
- **隨機按鍵** - 其他情況保持隨機行為
- **按鍵驗證** - 確保指定按鍵存在於映射中

### 重複控制
- **次數控制** - 限制特定操作的執行次數
- **時間控制** - 限制測試工具的運行時間
- **條件退出** - 達到條件時自動停止

## 品質要求
- **參數驗證** - 嚴格檢查輸入參數有效性
- **程式碼安全** - 確保修改後的程式碼語法正確
- **錯誤處理** - 完善的錯誤提示和恢復機制
- **日誌追蹤** - 詳細記錄所有操作過程

## 擴展性設計
- **插件架構** - 支援新的測試邏輯類型
- **模板系統** - 預定義常用測試模式
- **配置文件** - 支援複雜測試場景配置

---
建立時間: 2025-09-07
狀態: 需求分析完成
