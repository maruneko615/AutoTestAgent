# 功能需求規格

## 功能概述
製作一個執行檔，使用 Q CLI 根據配置文件和 Protobuf Schema 生成 UDP 通訊程式，實現與 Unreal 遊戲的遠端操控。

## 需求分析
### 輸入文件
- `GameSetting\AutoTest_Game_Setting.md` - 遊戲設定配置
- `ProtoSchema\GameFlowData_pb2.py` - 遊戲流程數據 Python 類別
- `ProtoSchema\GameFlowData.proto` - 遊戲流程數據 Proto 定義
- `ProtoSchema\InputCommand_pb2.py` - 輸入指令 Python 類別  
- `ProtoSchema\InputCommand.proto` - 輸入指令 Proto 定義

### 通訊協定
- **接收**: 遊戲端傳送 `GameFlowData` (UDP)
- **發送**: 程式傳送 `InputCommand` 給遊戲 (UDP)
- **目標**: 實現遠端操控遊戲功能

## 技術規格
### 核心架構
- UDP Socket 通訊
- Protobuf 訊息序列化/反序列化
- 基於 GameSetting 的邏輯處理
- 自動化輸入指令生成

### 程式流程
1. 解析配置文件
2. 建立 UDP 連線
3. 接收 GameFlowData
4. 根據遊戲狀態生成 InputCommand
5. 發送控制指令

## 實作細節

### 整體程式架構
```
AgentMaker (使用Q CLI製作功能的工具)
├── 讀取 GameSetting.md
├── 讀取 Protobuf Schema  
├── 分析遊戲邏輯需求
├── 呼叫 Q CLI 生成程式碼
└── 輸出 AutoTestAgent.exe

AutoTestAgent.exe (最終產出的遊戲控制程式)
├── 1. UDP 通訊模組 (UDPCommunicator)
│   ├── 建立 UDP Socket 連線
│   ├── 接收 GameFlowData (Protobuf)
│   └── 發送 InputCommand (Protobuf)
├── 2. 遊戲狀態機 (GameStateMachine)
│   ├── 狀態匹配與分派
│   ├── 狀態處理器註冊
│   └── 狀態轉換邏輯
├── 3. 操作處理器 (ActionProcessor)
│   ├── 選項導航邏輯
│   ├── 按鍵序列生成
│   └── 目標達成檢測
└── 4. 主控制器 (MainController)
    ├── 模組協調
    ├── 錯誤處理
    └── 日誌記錄
```

### 程式執行流程
```
1. 啟動階段
   ├── 初始化 Protobuf Schema
   ├── 建立 UDP Socket 連線
   └── 註冊狀態處理器

2. 運行階段 (循環)
   ├── 接收 GameFlowData
   ├── 解析遊戲狀態
   ├── 匹配對應處理器
   ├── 生成操作指令
   ├── 發送 InputCommand
   └── 記錄操作日誌

3. 錯誤處理
   ├── 連線中斷重連
   ├── 訊息解析失敗
   ├── 狀態處理異常
   └── 優雅關閉程序
```

### 核心介面設計
```python
# 狀態處理器介面
class StateHandler:
    def can_handle(self, game_data) -> bool
    def process(self, game_data) -> InputCommand

# 主程式介面
class AutoTestAgent:
    def start_udp_server(self)
    def register_handlers(self)
    def run(self)
```

## 測試計畫
[待補充測試計畫]

---
建立時間: 2025-09-06
狀態: 需求分析完成
